"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[217],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return u}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=p(n),u=r,y=m["".concat(s,".").concat(u)]||m[u]||d[u]||l;return n?a.createElement(y,o(o({ref:t},c),{},{components:n})):a.createElement(y,o({ref:t},c))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var p=2;p<l;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7336:function(e,t,n){n.r(t),n.d(t,{contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return i},metadata:function(){return p},toc:function(){return c}});var a=n(7462),r=n(3366),l=(n(7294),n(3905)),o=["components"],i={sidebar_position:1},s="$WRLD Payments API Plugin",p={unversionedId:"payments/wrld-payments-api",id:"payments/wrld-payments-api",isDocsHomePage:!1,title:"$WRLD Payments API Plugin",description:"The WRLD Payments API provides Spigot plugins with the ability to:",source:"@site/docs/payments/wrld-payments-api.md",sourceDirName:"payments",slug:"/payments/wrld-payments-api",permalink:"/payments/wrld-payments-api",editUrl:"https://github.com/NFT-Worlds/dev.nftworlds.com/edit/main/docs/payments/wrld-payments-api.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Smart Contract Links",permalink:"/architecture/contracts"},next:{title:"$WRLD Commands Plugin",permalink:"/payments/wrld-payments-commands"}},c=[{value:"Plugin integration",id:"plugin-integration",children:[{value:"Include the library with the build",id:"include-the-library-with-the-build",children:[{value:"Maven",id:"maven",children:[],level:4},{value:"Gradle",id:"gradle",children:[],level:4}],level:3},{value:"Declare dependency in plugin.yml",id:"declare-dependency-in-pluginyml",children:[],level:3}],level:2},{value:"Paying players with server-to-player transactions",id:"paying-players-with-server-to-player-transactions",children:[],level:2},{value:"Configuring Ethereum and Polygon RPC endpoints",id:"configuring-ethereum-and-polygon-rpc-endpoints",children:[],level:2},{value:"Getting balances for custom ERC20 tokens",id:"getting-balances-for-custom-erc20-tokens",children:[],level:2},{value:"Reference",id:"reference",children:[{value:'<a href="/payments-javadoc/com/nftworlds/wallet/api/WalletAPI.html" target="_blank">WalletAPI</a>',id:"walletapi",children:[],level:3},{value:'<a target="_blank" href="/payments-javadoc/com/nftworlds/wallet/objects/NFTPlayer.html">NFTPlayer</a>',id:"nftplayer",children:[],level:3},{value:'<a target="_blank" href="/payments-javadoc/com/nftworlds/wallet/event/PlayerTransactEvent.html">PlayerTransactEvent</a>',id:"playertransactevent",children:[],level:3},{value:'<a href="/payments-javadoc/com/nftworlds/wallet/event/PeerToPeerPayEvent.html" target="_blank">PeerToPeerPayEvent</a>',id:"peertopeerpayevent",children:[],level:3}],level:2}],d={toc:c};function m(e){var t=e.components,i=(0,r.Z)(e,o);return(0,l.kt)("wrapper",(0,a.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"wrld-payments-api-plugin"},"$WRLD Payments API Plugin"),(0,l.kt)("p",null,"The ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/NFT-Worlds/WRLD-Payments-API"},"WRLD Payments API")," provides Spigot plugins with the ability to:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Create player payment requests from the server (such as charging for in-world experiences)"),(0,l.kt)("li",{parentName:"ul"},"Initiate player-to-player transfers"),(0,l.kt)("li",{parentName:"ul"},"Recieve information about completed transactions")),(0,l.kt)("h2",{id:"plugin-integration"},"Plugin integration"),(0,l.kt)("p",null,"This section assumes you've already ",(0,l.kt)("a",{parentName:"p",href:"https://www.spigotmc.org/wiki/creating-a-plugin-with-maven-using-intellij-idea/"},"set up a Spigot plugin using IntelliJ and Maven"),"."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Important: you must replace the Spigot API in your ",(0,l.kt)("inlineCode",{parentName:"strong"},"pom.xml")," with the Paper API"),". If you have an ",(0,l.kt)("inlineCode",{parentName:"p"},"org.spigotmc:spigot-api")," dependency, replace it with this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"<dependency>\n    <groupId>io.papermc.paper</groupId>\n    <artifactId>paper-api</artifactId>\n    <version>1.17.1-R0.1-SNAPSHOT</version>\n    <scope>provided</scope>\n</dependency>\n")),(0,l.kt)("h3",{id:"include-the-library-with-the-build"},"Include the library with the build"),(0,l.kt)("h4",{id:"maven"},"Maven"),(0,l.kt)("p",null,"Open ",(0,l.kt)("inlineCode",{parentName:"p"},"pom.xml"),". Add new entries under ",(0,l.kt)("inlineCode",{parentName:"p"},"<repositories>")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"<dependencies>")," like so:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-xml"},"<repositories>\n...\n\n    <repository>\n        <id>worldql-partners</id>\n        <url>https://maven.worldql.com/releases</url>\n    </repository>\n</repositories>\n\n<dependencies>\n...\n\n    <dependency>\n        <groupId>com.nftworlds</groupId>\n        <artifactId>wrld-payments-api</artifactId>\n        <version>0.1.6</version>\n    </dependency>\n\n</dependencies>\n")),(0,l.kt)("h4",{id:"gradle"},"Gradle"),(0,l.kt)("p",null,"Open ",(0,l.kt)("inlineCode",{parentName:"p"},"build.gradle"),". Append to ",(0,l.kt)("inlineCode",{parentName:"p"},"repositories")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"dependencies")," clauses like so:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-groovy"},"repositories: {\n    maven {\n        url \"https://maven.worldql.com/releases\"\n    }\n}\ndependencies {\n    ...\n    \n    compileOnly 'com.nftworlds:wrld-payments-api:0.1.6'\n}\n")),(0,l.kt)("h3",{id:"declare-dependency-in-pluginyml"},"Declare dependency in plugin.yml"),(0,l.kt)("p",null,"To ensure that the library gets loaded properly, we need to depend on the plugin in ",(0,l.kt)("inlineCode",{parentName:"p"},"plugin.yml"),".\nOpen ",(0,l.kt)("inlineCode",{parentName:"p"},"src/main/resources/plugin.yml")," and append the following:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'...\ndepend: ["WRLDPaymentsAPI"]\n')),(0,l.kt)("p",null,"The resulting ",(0,l.kt)("inlineCode",{parentName:"p"},"plugin.yml")," should look like so:"),(0,l.kt)("p",null,(0,l.kt)("img",{alt:"plugin.yml example",src:n(3581).Z})),(0,l.kt)("h2",{id:"paying-players-with-server-to-player-transactions"},"Paying players with server-to-player transactions"),(0,l.kt)("p",null,"If you want to reward players for achieving victory in your world, you can use the ",(0,l.kt)("inlineCode",{parentName:"p"},"Wallet.payPlayer")," method."),(0,l.kt)("p",null,"First, you'll need to configure your ",(0,l.kt)("inlineCode",{parentName:"p"},"config.yml")," with a ",(0,l.kt)("inlineCode",{parentName:"p"},"server_wallet_private_key"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yml"},'server_wallet_private_key: "0xYourPrivateKey"\n')),(0,l.kt)("p",null,"You will see a warning in your server logs:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"[14:27:04 WARN]: A private key has been set in the plugin config! Only install plugins you trust. \n")),(0,l.kt)("p",null,"Now, you can use the Java API to send payments to players:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'Player payee = Bukkit.getPlayer(someUUID);\ndouble amount = Double.parseDouble("0.25");\nString reason = "Congrats on completing the parkour challenge!";\n\nWRLDPaymentsCommands.getPayments().getNFTPlayer(payee)\n    .getPrimaryWallet().payWRLD(amount, Network.POLYGON, reason);\n')),(0,l.kt)("p",null,"The player will be immediately notified they have an incoming pending transactions. Within a minute, the player will be notified of the successful incoming payment alongside a clickable link to a block explorer.\n",(0,l.kt)("img",{alt:"Successful payment chat message",src:n(2857).Z})),(0,l.kt)("h2",{id:"configuring-ethereum-and-polygon-rpc-endpoints"},"Configuring Ethereum and Polygon RPC endpoints"),(0,l.kt)("p",null,"In order to use the WRLD Payments API, you must obtain HTTPS RPC endpoints for both Ethereum and Polygon. If you don't host your own node, we recommend ",(0,l.kt)("a",{parentName:"p",href:"https://www.alchemy.com/"},"Alchemy"),". These endpoints can be set using ",(0,l.kt)("inlineCode",{parentName:"p"},"polygon_https_rpc")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"ethereum_https_rpc")," in ",(0,l.kt)("inlineCode",{parentName:"p"},"plugins/WRLDPaymentsAPI/config.yml"),". A correct configuration looks like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yml"},"polygon_https_rpc: https://polygon-mainnet.g.alchemy.com/v2/YourAPIKeyHere\nethereum_https_rpc: https://eth-mainnet.alchemyapi.io/v2/YourAPIKeyHere\n")),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"If you get the error ",(0,l.kt)("inlineCode",{parentName:"p"},"Invalid request: method not supported eth_newFilter")," be sure you're using an endpoint provided by ",(0,l.kt)("strong",{parentName:"p"},"Alchemy API"),". Infura has compatibility issues with our plugin due to not providing certain functionality over HTTPS."))),(0,l.kt)("h2",{id:"getting-balances-for-custom-erc20-tokens"},"Getting balances for custom ERC20 tokens"),(0,l.kt)("p",null,"If you want to get a user's balance for an ERC20 token that isn't WRLD, we have an API method to make that easy:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'Wallet playerWallet = WRLDPaymentsCommands.getPayments().getNFTPlayer(examplePlayer);\n// This is a blocking call and will fetch and update player balances before moving to the next line\n// Be sure not to run this lookup in the main thread\nwallet.refreshERC20Balance(Network.POLYGON, "0xYourTokenContractAddress");\n// Now, you can access the player\'s balance through a hashmap member of the wallet\ndouble playerBalance = wallet.getCustomPolygonBalances().get("0xYourTokenContractAddress");\n')),(0,l.kt)("p",null,"To get the underlying web3j wrapper for direct access to the smart contract, use the following:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},'ERC20 myCustomToken = wallet.getCustomEthereumTokenWrappers().get("0xYourTokenContractAddress");\n// access any of the standard web3j ERC20 contract features\nmyCustomToken.transfer("0xSomeone", new BigInteger("10000"));\n')),(0,l.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Currently, these API methods load custom ERC20 contracts using the server's default private key (the same one used for WRLD). When calling the ",(0,l.kt)("inlineCode",{parentName:"p"},"transfer")," function on the underlying contract, be aware that you are not transferring player funds but server funds."),(0,l.kt)("p",{parentName:"div"},"This API will be updated to allow sending arbitrary ERC20 tokens with a convenience method that abstracts the contract wrapper. If you'd like this feature expedited, let us know! If you need more flexibility, we recommend using ",(0,l.kt)("a",{parentName:"p",href:"https://docs.web3j.io/4.8.7/smart_contracts/contracts_supported_by_web3j/#eip20"},"the web3j ERC20 wrapper directly"),"."))),(0,l.kt)("h2",{id:"reference"},"Reference"),(0,l.kt)("p",null,"Click on any header to go to the Javadocs for that class. "),(0,l.kt)("h3",{id:"walletapi"},(0,l.kt)("a",{href:"/payments-javadoc/com/nftworlds/wallet/api/WalletAPI.html",target:"_blank"},"WalletAPI")),(0,l.kt)("p",null,"This is the main class you should use when writing a plugin. Create an instance of it and reuse it across your plugin."),(0,l.kt)("h3",{id:"nftplayer"},(0,l.kt)("a",{target:"_blank",href:"/payments-javadoc/com/nftworlds/wallet/objects/NFTPlayer.html"},"NFTPlayer")),(0,l.kt)("p",null,"The class used throughout the WRLD Payments API to represent a player and their attached wallets."),(0,l.kt)("h3",{id:"playertransactevent"},(0,l.kt)("a",{target:"_blank",href:"/payments-javadoc/com/nftworlds/wallet/event/PlayerTransactEvent.html"},"PlayerTransactEvent")),(0,l.kt)("p",null,"Listen for this event to detect completed player-to-server transactions."),(0,l.kt)("h3",{id:"peertopeerpayevent"},(0,l.kt)("a",{href:"/payments-javadoc/com/nftworlds/wallet/event/PeerToPeerPayEvent.html",target:"_blank"},"PeerToPeerPayEvent")),(0,l.kt)("p",null,"Listen for this event to detect completed peer-to-peer transactions."),(0,l.kt)("p",null,"These are just the most important classes, ",(0,l.kt)("strong",{parentName:"p"},"please explore the ",(0,l.kt)("a",{target:"_blank",href:"/payments-javadoc/index.html"},"auto-generated Javadocs")," for complete reference documentation"),"."))}m.isMDXComponent=!0},2857:function(e,t,n){t.Z=n.p+"assets/images/successfulpayment-f3acdee567661d140e19add942f92beb.png"},3581:function(e,t,n){t.Z=n.p+"assets/images/wrld-payments-api-pluginyml-8c2aca619bf3371dbd07983409a53e72.png"}}]);